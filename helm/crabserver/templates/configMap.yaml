{{- $environment := .Values.environment | default dict }}
{{- if .Values.enabled -}}
kind: ConfigMap
apiVersion: v1
metadata:
  name: crabserver
  labels:
    env: k8s-{{$environment}}
    app: crabserver
  namespace: crab
data:
  entrypoint.sh: |
{{ (.Files.Get "scripts/entrypoint.sh" | indent 4) }}
  config.py: |
{{- if .Values.crabserver.configPy }}
{{ .Values.crabserver.configPy | nindent 4 }}
{{- else }}
{{ (.Files.Get (printf "config/%s/config.py" $environment) | indent 4) }}
{{- end }}
{{- end }}
